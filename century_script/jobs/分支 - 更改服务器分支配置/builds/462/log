Started by user [8mha:////4NL15lwhNok46o8LpNIYOqAIaurwr6Vm2yW5YSW4R5+wAAAAlh+LCAAAAAAAAP9b85aBtbiIQTGjNKU4P08vOT+vOD8nVc83PyU1x6OyILUoJzMv2y+/JJUBAhiZGBgqihhk0NSjKDWzXb3RdlLBUSYGJk8GtpzUvPSSDB8G5tKinBIGIZ+sxLJE/ZzEvHT94JKizLx0a6BxUmjGOUNodHsLgAyWEgYu/dLi1CL9ovz8EgDKVWzSvwAAAA==[0mroot
Running as SYSTEM
[EnvInject] - Loading node environment variables.
Building in workspace /var/jenkins_home/workspace/分支 - 更改服务器分支配置
[8mha:////4ACNv3kH5j8HGuwNujCwccjKlOfpFnZAZEpMe6svfNUvAAAAqx+LCAAAAAAAAP9b85aBtbiIQSujNKU4P0+vIKc0PTOvWC8xrzgzOT8nv0gvMbkkEyjhCKb88ktSdwVsu2efuqidiYHRh4EDIu2ZUsIg5JOVWJaon5OYl64fXFKUmZduXVHEIAU1ODk/rzg/J1XPGUKDDGKAAEYmBoaKghIGlUTDNJNUA8tEXQNDkxRdk1RjI11L41RzXVNTw0RTE5OURMtEQwAZ788IrwAAAA==[0m[SSH] executing pre build script:
GAME_BR="feature/journey_booster_pr6"
GAME_CONF="deploy-cc-conf"
server_name="pk7017"
BANDIT_BR="develop"
BANDIT_CONF="deploy-bandit-conf"

#!/bin/bash

source /root/jenkins/jk_func.sh

if [ -z "$server_name" ]; then
    echo "Error: 没有选择服务器!"
    exit 1
fi

file_lock
LINE_NO=$(grep -n "${server_name}:" $conf_file | awk -F ":" '{print $1}')
echo $LINE_NO
mod_branch $LINE_NO $GAME_BR $BANDIT_BR $GAME_CONF $BANDIT_CONF
file_unlock
脚本可执行
199

before setting
pk7017:
 port: 7207 
 game: feature/journey_booster_pr5
 bandit: develop
 cc-conf: deploy-cc-conf
 bandit-conf: deploy-bandit-conf
释放脚本锁

[SSH] completed
[SSH] exit-status: 0

[SSH] executing post build script:
GAME_BR="feature/journey_booster_pr6"
GAME_CONF="deploy-cc-conf"
server_name="pk7017"
BANDIT_BR="develop"
BUILD_URL="http://10.0.84.16:8083/job/%E5%88%86%E6%94%AF%20-%20%E6%9B%B4%E6%94%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%86%E6%94%AF%E9%85%8D%E7%BD%AE/462/"
BANDIT_CONF="deploy-bandit-conf"

conf_file=~/jenkins/server_config.yaml
cat $conf_file | grep $server_name -C 6

cd /mnt/slots/bandit-server && git remote update
cd /mnt/slots/cc-server && git remote update
cd /var/lib/docker/volumes/jenkins-data/_data && python update_server_list.py

curl 'https://oapi.dingtalk.com/robot/send?access_token=13aa551ba8a79265c4424316089cd31c4f479b0f685f3d5a503b0ab6a1a42ec7' -H 'Content-Type: application/json'  -d '{"msgtype": "text","text": {"content": "Jenkins-Server['"${server_name}"'] Change To Game['"${GAME_BR}"'] RPC['"${BANDIT_BR}"'] GAME_CONF['"${GAME_CONF}"'] BANDIT_CONF['"${BANDIT_CONF}"'] "}}'

source /root/jenkins/jk_func.sh
~/jenkins/analyze_log/analyze_err -url ${BUILD_URL}
 bandit: develop
 cc-conf: deploy-cc-conf
 bandit-conf: deploy-bandit-conf
 rpc_port: 7116
 desc: pk7016 

pk7017:
 port: 7207 
 game: feature/journey_booster_pr6
 bandit: develop
 cc-conf: deploy-cc-conf
 bandit-conf: deploy-bandit-conf
 rpc_port: 7117
 desc: pk7017 

pk7018:
 port: 7208 
 game: feature/card_end_pr1
 bandit: develop
 cc-conf: deploy-cc-conf
Fetching origin
Fetching origin
remote: Enumerating objects: 63, done.[K
remote: Counting objects:   2% (1/46)[Kremote: Counting objects:   4% (2/46)[Kremote: Counting objects:   6% (3/46)[Kremote: Counting objects:   8% (4/46)[Kremote: Counting objects:  10% (5/46)[Kremote: Counting objects:  13% (6/46)[Kremote: Counting objects:  15% (7/46)[Kremote: Counting objects:  17% (8/46)[Kremote: Counting objects:  19% (9/46)[Kremote: Counting objects:  21% (10/46)[Kremote: Counting objects:  23% (11/46)[Kremote: Counting objects:  26% (12/46)[Kremote: Counting objects:  28% (13/46)[Kremote: Counting objects:  30% (14/46)[Kremote: Counting objects:  32% (15/46)[Kremote: Counting objects:  34% (16/46)[Kremote: Counting objects:  36% (17/46)[Kremote: Counting objects:  39% (18/46)[Kremote: Counting objects:  41% (19/46)[Kremote: Counting objects:  43% (20/46)[Kremote: Counting objects:  45% (21/46)[Kremote: Counting objects:  47% (22/46)[Kremote: Counting objects:  50% (23/46)[Kremote: Counting objects:  52% (24/46)[Kremote: Counting objects:  54% (25/46)[Kremote: Counting objects:  56% (26/46)[Kremote: Counting objects:  58% (27/46)[Kremote: Counting objects:  60% (28/46)[Kremote: Counting objects:  63% (29/46)[Kremote: Counting objects:  65% (30/46)[Kremote: Counting objects:  67% (31/46)[Kremote: Counting objects:  69% (32/46)[Kremote: Counting objects:  71% (33/46)[Kremote: Counting objects:  73% (34/46)[Kremote: Counting objects:  76% (35/46)[Kremote: Counting objects:  78% (36/46)[Kremote: Counting objects:  80% (37/46)[Kremote: Counting objects:  82% (38/46)[Kremote: Counting objects:  84% (39/46)[Kremote: Counting objects:  86% (40/46)[Kremote: Counting objects:  89% (41/46)[Kremote: Counting objects:  91% (42/46)[Kremote: Counting objects:  93% (43/46)[Kremote: Counting objects:  95% (44/46)[Kremote: Counting objects:  97% (45/46)[Kremote: Counting objects: 100% (46/46)[Kremote: Counting objects: 100% (46/46), done.[K
remote: Compressing objects:   2% (1/35)[Kremote: Compressing objects:   5% (2/35)[Kremote: Compressing objects:   8% (3/35)[Kremote: Compressing objects:  11% (4/35)[Kremote: Compressing objects:  14% (5/35)[Kremote: Compressing objects:  17% (6/35)[Kremote: Compressing objects:  20% (7/35)[Kremote: Compressing objects:  22% (8/35)[Kremote: Compressing objects:  25% (9/35)[Kremote: Compressing objects:  28% (10/35)[Kremote: Compressing objects:  31% (11/35)[Kremote: Compressing objects:  34% (12/35)[Kremote: Compressing objects:  37% (13/35)[Kremote: Compressing objects:  40% (14/35)[Kremote: Compressing objects:  42% (15/35)[Kremote: Compressing objects:  45% (16/35)[Kremote: Compressing objects:  48% (17/35)[Kremote: Compressing objects:  51% (18/35)[Kremote: Compressing objects:  54% (19/35)[Kremote: Compressing objects:  57% (20/35)[Kremote: Compressing objects:  60% (21/35)[Kremote: Compressing objects:  62% (22/35)[Kremote: Compressing objects:  65% (23/35)[Kremote: Compressing objects:  68% (24/35)[Kremote: Compressing objects:  71% (25/35)[Kremote: Compressing objects:  74% (26/35)[Kremote: Compressing objects:  77% (27/35)[Kremote: Compressing objects:  80% (28/35)[Kremote: Compressing objects:  82% (29/35)[Kremote: Compressing objects:  85% (30/35)[Kremote: Compressing objects:  88% (31/35)[Kremote: Compressing objects:  91% (32/35)[Kremote: Compressing objects:  94% (33/35)[Kremote: Compressing objects:  97% (34/35)[Kremote: Compressing objects: 100% (35/35)[Kremote: Compressing objects: 100% (35/35), done.[K
Unpacking objects:   1% (1/63)   Unpacking objects:   3% (2/63)   Unpacking objects:   4% (3/63)   Unpacking objects:   6% (4/63)   Unpacking objects:   7% (5/63)   Unpacking objects:   9% (6/63)   Unpacking objects:  11% (7/63)   Unpacking objects:  12% (8/63)   Unpacking objects:  14% (9/63)   Unpacking objects:  15% (10/63)   Unpacking objects:  17% (11/63)   Unpacking objects:  19% (12/63)   Unpacking objects:  20% (13/63)   Unpacking objects:  22% (14/63)   Unpacking objects:  23% (15/63)   Unpacking objects:  25% (16/63)   Unpacking objects:  26% (17/63)   Unpacking objects:  28% (18/63)   Unpacking objects:  30% (19/63)   Unpacking objects:  31% (20/63)   Unpacking objects:  33% (21/63)   Unpacking objects:  34% (22/63)   Unpacking objects:  36% (23/63)   remote: Total 63 (delta 11), reused 11 (delta 11), pack-reused 17[K
Unpacking objects:  38% (24/63)   Unpacking objects:  39% (25/63)   Unpacking objects:  41% (26/63)   Unpacking objects:  42% (27/63)   Unpacking objects:  44% (28/63)   Unpacking objects:  46% (29/63)   Unpacking objects:  47% (30/63)   Unpacking objects:  49% (31/63)   Unpacking objects:  50% (32/63)   Unpacking objects:  52% (33/63)   Unpacking objects:  53% (34/63)   Unpacking objects:  55% (35/63)   Unpacking objects:  57% (36/63)   Unpacking objects:  58% (37/63)   Unpacking objects:  60% (38/63)   Unpacking objects:  61% (39/63)   Unpacking objects:  63% (40/63)   Unpacking objects:  65% (41/63)   Unpacking objects:  66% (42/63)   Unpacking objects:  68% (43/63)   Unpacking objects:  69% (44/63)   Unpacking objects:  71% (45/63)   Unpacking objects:  73% (46/63)   Unpacking objects:  74% (47/63)   Unpacking objects:  76% (48/63)   Unpacking objects:  77% (49/63)   Unpacking objects:  79% (50/63)   Unpacking objects:  80% (51/63)   Unpacking objects:  82% (52/63)   Unpacking objects:  84% (53/63)   Unpacking objects:  85% (54/63)   Unpacking objects:  87% (55/63)   Unpacking objects:  88% (56/63)   Unpacking objects:  90% (57/63)   Unpacking objects:  92% (58/63)   Unpacking objects:  93% (59/63)   Unpacking objects:  95% (60/63)   Unpacking objects:  96% (61/63)   Unpacking objects:  98% (62/63)   Unpacking objects: 100% (63/63)   Unpacking objects: 100% (63/63), done.
From gitlab.funplus.io:cheesecake/cc-server
 * [new branch]      feature/journey_booster_pr6 -> origin/feature/journey_booster_pr6
SL=pkzxj,pkyq,pktest,pkreview,pkjy,pkcp,pk7020,pk7019,pk7018,pk7017,pk7016,pk7015,pk7014,pk7013,pk7012,pk7011,pk7010,pk7009,pk7008,pk7007,pk7006,pk7005,pk7004,pk7003,pk7002,pk7001
SLDesc=[ pkzxj ] game:[ develop ] bandit:[ develop ] port:[ 8888 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pkyq ] game:[ pre/v0.12.2 ] bandit:[ pre/v0.12.2 ] port:[ 3333 ] cc-conf[ pre/v0.12.2 ] bd-conf[ pre/v0.12.2 ],[ pktest ] game:[ develop ] bandit:[ develop ] port:[ 6666 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pkreview ] game:[ pre/v0.13.7 ] bandit:[ pre/v0.13.7 ] port:[ 4444 ] cc-conf[ pre/v0.13.7 ] bd-conf[ pre/v0.13.7 ],[ pkjy ] game:[ feature/disco-sp1 ] bandit:[ feature/disco-personal ] port:[ 5555 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pkcp ] game:[ feature/spin_max_bonus ] bandit:[ develop ] port:[ 9999 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7020 ] game:[ develop ] bandit:[ develop ] port:[ 7210 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7019 ] game:[ feature/new_quest ] bandit:[ develop ] port:[ 7209 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7018 ] game:[ feature/card_end_pr1 ] bandit:[ develop ] port:[ 7208 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7017 ] game:[ feature/journey_booster_pr6 ] bandit:[ develop ] port:[ 7207 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7016 ] game:[ develop ] bandit:[ develop ] port:[ 7206 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7015 ] game:[ develop ] bandit:[ develop ] port:[ 7205 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7014 ] game:[ feature/piggyPinata ] bandit:[ feature/piggyPinata ] port:[ 7204 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ qunlong/pk7013 ] game:[ pre/v0.13.7 ] bandit:[ pre/v0.13.7 ] port:[ 7203 ] cc-conf[ pre/v0.13.7 ] bd-conf[ pre/v0.13.7 ],[ tanghao/pk7012 ] game:[ develop ] bandit:[ develop ] port:[ 7202 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ yanqiao/pk7011 ] game:[ pre/v0.13.6 ] bandit:[ pre/v0.13.6 ] port:[ 7201 ] cc-conf[ pre/v0.13.6 ] bd-conf[ pre/v0.13.6 ],[ pk7010 ] game:[ feature/luckyCard ] bandit:[ develop ] port:[ 7100 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7009 ] game:[ bugfix/lobbyPromotin ] bandit:[ develop ] port:[ 7009 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7008 ] game:[ feature/goldenPharaoh_animation ] bandit:[ feature/goldenPharaoh ] port:[ 7008 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7007 ] game:[ feature/luckyCard ] bandit:[ develop ] port:[ 7007 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7006 ] game:[ develop ] bandit:[ develop ] port:[ 7006 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7005 ] game:[ feature/disco-personal ] bandit:[ feature/disco-personal ] port:[ 7005 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7004 ] game:[ feature/siberianWolf ] bandit:[ feature/siberianWolf ] port:[ 7004 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ cehua/pk7003 ] game:[ develop ] bandit:[ develop ] port:[ 7003 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7002 ] game:[ feature/endless2 ] bandit:[ develop ] port:[ 7002 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ],[ pk7001 ] game:[ develop ] bandit:[ bugfix/lavaCash_polish ] port:[ 7001 ] cc-conf[ deploy-cc-conf ] bd-conf[ deploy-bandit-conf ]
{"errcode":0,"errmsg":"ok"}
[SSH] completed
[SSH] exit-status: 0

Finished: SUCCESS
