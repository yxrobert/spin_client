Started by user [8mha:////4NDDH4Ur3y+hhc2tlh2iQKYKJ9uMQ8gxp7Z2v74oPlG+AAAAlR+LCAAAAAAAAP9b85aBtbiIQTGjNKU4P08vOT+vOD8nVc83PyU1x6OyILUoJzMv2y+/JJUBAhiZGBgqihhk0NSjKDWzXb3RdlLBUSYGJk8GtpzUvPSSDB8G5tKinBIGIZ+sxLJE/ZzEvHT94JKizLx0a6BxUmjGOUNodHsLgAyWEgYu/dLi1CJ9oHWJAH7c4RK/AAAA[0mlina
Running as SYSTEM
[EnvInject] - Loading node environment variables.
Building in workspace /var/jenkins_home/workspace/ÊúçÂä°Âô® - ÂçïÁã¨Êõ¥Êñ∞RPC-Server
[8mha:////4HLbU0PTZt/r7MKhmFD44Nnh1UogEUvi5ET696TyYhGXAAAAqx+LCAAAAAAAAP9b85aBtbiIQSujNKU4P0+vIKc0PTOvWC8xrzgzOT8nv0gvMbkkEyjhCKb88ktSdwVsu2efuqidiYHRh4EDIu2ZUsIg5JOVWJaon5OYl64fXFKUmZduXVHEIAU1ODk/rzg/J1XPGUKDDGKAAEYmBoaKghIGFUNjS0sTMwMjXQtD41Rdk2SjNN1ES9NkXdMUS5M0Q1MLQyOjRABEYgYTrwAAAA==[0m[SSH] executing pre build script:
server_name="pktest"

#!/bin/bash 
source /root/jenkins/jk_func.sh

if [ -z "$server_name" ]; then
    echo "Error: Ê≤°ÊúâÈÄâÊã©ÊúçÂä°Âô®!"
    exit 1
fi

file_lock

yaml $conf_file "['$server_name']"
branch_name=$(yaml $conf_file "['$server_name']['bandit']")
rpc_port=$(yaml $conf_file "['$server_name']['rpc_port']")

cd /mnt/slots/bandit-server
git cd $branch_name
check_last_cmd branch

git pull
check_last_cmd pull

cd /mnt/slots/cc-slots-land/batch
./compile_rpc.sh $server_name && ./build_image_rpc.sh $server_name && ./run_image_rpc.sh $server_name $rpc_port

file_unlock
ËÑöÊú¨ÂèØÊâßË°å
{'bandit': 'develop', 'game': 'develop', 'cc-conf': 'deploy-cc-conf', 'desc': 'pktest', 'rpc_port': 6676, 'bandit-conf': 'deploy-bandit-conf', 'port': 6666}
Switched to branch 'develop'
remote: Enumerating objects: 14, done.[K
remote: Counting objects:   7% (1/14)[Kremote: Counting objects:  14% (2/14)[Kremote: Counting objects:  21% (3/14)[Kremote: Counting objects:  28% (4/14)[Kremote: Counting objects:  35% (5/14)[Kremote: Counting objects:  42% (6/14)[Kremote: Counting objects:  50% (7/14)[Kremote: Counting objects:  57% (8/14)[Kremote: Counting objects:  64% (9/14)[Kremote: Counting objects:  71% (10/14)[Kremote: Counting objects:  78% (11/14)[Kremote: Counting objects:  85% (12/14)[Kremote: Counting objects:  92% (13/14)[Kremote: Counting objects: 100% (14/14)[Kremote: Counting objects: 100% (14/14), done.[K
remote: Compressing objects:   8% (1/12)[Kremote: Compressing objects:  16% (2/12)[Kremote: Compressing objects:  25% (3/12)[Kremote: Compressing objects:  33% (4/12)[Kremote: Compressing objects:  41% (5/12)[Kremote: Compressing objects:  50% (6/12)[Kremote: Compressing objects:  58% (7/12)[Kremote: Compressing objects:  66% (8/12)[Kremote: Compressing objects:  75% (9/12)[Kremote: Compressing objects:  83% (10/12)[Kremote: Compressing objects:  91% (11/12)[Kremote: Compressing objects: 100% (12/12)[Kremote: Compressing objects: 100% (12/12), done.[K
remote: Total 14 (delta 2), reused 12 (delta 1), pack-reused 0[K
Unpacking objects:   7% (1/14)   Unpacking objects:  14% (2/14)   Unpacking objects:  21% (3/14)   Unpacking objects:  28% (4/14)   Unpacking objects:  35% (5/14)   Unpacking objects:  42% (6/14)   Unpacking objects:  50% (7/14)   Unpacking objects:  57% (8/14)   Unpacking objects:  64% (9/14)   Unpacking objects:  71% (10/14)   Unpacking objects:  78% (11/14)   Unpacking objects:  85% (12/14)   Unpacking objects:  92% (13/14)   Unpacking objects: 100% (14/14)   Unpacking objects: 100% (14/14), done.
From gitlab.funplus.io:fruities/bandit-server
   412c8e3..475b39e  develop    -> origin/develop
 * [new branch]      feature/zhaoCaiJinBao-legend -> origin/feature/zhaoCaiJinBao-legend
Updating 412c8e3..475b39e
Fast-forward
 themes/cmd/zhaoCaiJinBao/main.go       |  66 [32m++++++++++++[m[31m------[m
 themes/game/zhaoCaiJinBao/game.go      |   8 [32m+++[m
 themes/game/zhaoCaiJinBao/gameBase.go  | 118 [32m++++++++++++++++++++++++++[m[31m-------[m
 themes/game/zhaoCaiJinBao/gameBonus.go |   1 [31m-[m
 themes/game/zhaoCaiJinBao/gameFree.go  |   1 [31m-[m
 themes/game/zhaoCaiJinBao/weights.go   |   2 [32m+[m[31m-[m
 6 files changed, 148 insertions(+), 48 deletions(-)
[0;35m              ARCH:[0m linux
[0;35m          LOCAL_IP:[0m 10.0.84.16
[0;35m               APP:[0m pktest
[0;32m           APP_DIR:[0m /home/user00/cc/cc-slots-land/stage/app=pktest/app
[0;32m       Fluentd-DIR:[0m /mnt/slots/cc-slots-land/batch/pktest/fluentd
[0;32m         Mongo-DIR:[0m /mnt/slots/cc-slots-land/batch/pktest/mongo
[0;32m         Redis-DIR:[0m /mnt/slots/cc-slots-land/batch/pktest/redis
[0;32m       PM_CONF_DIR:[0m /home/user00/cc/cc-conf/gen/rawdata/server
[0;35m  BACKEND_CODE_DIR:[0m /home/user00/cc/cc-server
[0;35m  BACKEND_CONF_DIR:[0m /home/user00/cc/cc-conf
[1;33m   BANDIT_CODE_DIR:[0m /home/user00/cc/bandit-server
[1;33m   BANDIT_CONF_DIR:[0m /home/user00/cc/bandit-conf
[0;35m   BACKEND_PM_PATH:[0m /pktest_dev_backend
[1;33m    BANDIT_PM_PATH:[0m /pktest_dev_bandit
[0;35m           Network:[0m pktest
[0;35m    ETCD_ENDPOINTS:[0m 10.0.84.16:2379
[0;35m         REDIS_URI:[0m pktest-redis:6379
[0;35m Backend-Container:[0m pktest-backend
[1;33m  BANDIT-Container:[0m pktest-rpc
[0;32m Fluentd-Container:[0m pktest-fluentd
[0;32m   Mongo-Container:[0m pktest-mongo
[0;32m   Redis-Container:[0m pktest-redis
[1;33m            DATE:[0m 2023-03-29T16:42:22+0800
[1;33m   BUILD COMMAND:[0m cd bandit-server/cmd/server && go build -ldflags '-X main.buildTime=2023-03-29T16:42:22+0800 -X main.buildCodeVer=develop:475b39e -X main.buildConfVer=v1.1.16'
[1;33m           IMAGE:[0m slots/backend-builder:latest
[1;33m       CONTAINER:[0m rpc-backend-builder
[1;33m          GO_DIR:[0m /home/user00/cc/cc-slots-land/go
[1;33m        CODE_DIR:[0m /home/user00/cc/bandit-server develop:475b39e
[1;33m        CONF_DIR:[0m /home/user00/cc/bandit-conf v1.1.16
[1;33m       BUILD_DIR:[0m /slots
[1;33m  BUILD_CONF_DIR:[0m /cc-conf
[1;33m     CONFIG_FILE:[0m pktest/config.ini
[1;33mCONFIG_FILE_PROD:[0m pktest/config.ini
[0;32mMOUNT_CONF_LOADER => /home/user00/cc/bandit-conf/gen/golang/conf:/slots/server/pkg/gen/golang/conf[0m
[0;32m MOUNT_CONF_MODEL => /home/user00/cc/bandit-conf/gen/golang/rawdata:/cc-conf/gen/golang/rawdata[0m
[0;36mdocker run -it   --name "rpc-backend-builder"   --hostname "rpc-backend-builder"   -v "/home/user00/cc/cc-slots-land/go":/go   -v "/home/user00/cc/bandit-server":"/slots/bandit-server"   -v "/home/user00/cc/bandit-conf":"/slots/bandit-conf"   -v "/home/user00/cc/bandit-conf/gen/golang/conf:/slots/server/pkg/gen/golang/conf"   -v "/home/user00/cc/bandit-conf/gen/golang/rawdata:/cc-conf/gen/golang/rawdata"    "slots/backend-builder:latest"   sh -c "cd bandit-server/cmd/server && go build -ldflags '-X main.buildTime=2023-03-29T16:42:22+0800 -X main.buildCodeVer=develop:475b39e -X main.buildConfVer=v1.1.16'"[0m
[0;31mbuild failed[0m
ÈáäÊîæËÑöÊú¨ÈîÅ

[SSH] completed
[SSH] exit-status: 0

[SSH] executing post build script:
server_name="pktest"
BUILD_URL="http://10.0.84.16:8083/job/%E6%9C%8D%E5%8A%A1%E5%99%A8%20-%20%E5%8D%95%E7%8B%AC%E6%9B%B4%E6%96%B0RPC-Server/944/"

source /root/jenkins/jk_func.sh
~/jenkins/analyze_log/analyze_err -url ${BUILD_URL} && check_last_cmd report
sleep 5
check_whole_server $server_name

curl 'https://oapi.dingtalk.com/robot/send?access_token=13aa551ba8a79265c4424316089cd31c4f479b0f685f3d5a503b0ab6a1a42ec7' -H 'Content-Type: application/json'  -d '{"msgtype": "text","text": {"content": "Jenkins-RPC-Server['"${server_name}"'] Restart OK"}}'
pktest-backend Check
pktest-rpc Check
pktest-redis Check
pktest-mongo Check
pktest-fluentd Check
{"errcode":0,"errmsg":"ok"}
[SSH] completed
[SSH] exit-status: 0

Finished: SUCCESS
